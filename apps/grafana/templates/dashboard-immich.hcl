variable "dashboard_immich" {
  default = <<-EOH
{"annotations":{"list":[]},"editable":true,"fiscalYearStartMonth":0,"graphTooltip":1,"id":null,"links":[],"panels":[{"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":0},"id":1,"panels":[],"title":"Immich Info","type":"row"},{"datasource":{"type":"prometheus","uid":"$${DS_PROMETHEUS}"},"fieldConfig":{"defaults":{"mappings":[{"options":{"0":{"color":"red","index":1,"text":"DOWN"},"1":{"color":"green","index":0,"text":"UP"}},"type":"value"}],"thresholds":{"mode":"absolute","steps":[{"color":"red","value":null},{"color":"green","value":1}]}},"overrides":[]},"gridPos":{"h":4,"w":3,"x":0,"y":1},"id":2,"options":{"colorMode":"value","graphMode":"none","justifyMode":"center","orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"title":"Status","type":"stat","targets":[{"expr":"up{job=\"immich-metrics\"}","refId":"A"}]},{"datasource":{"type":"prometheus","uid":"$${DS_PROMETHEUS}"},"fieldConfig":{"defaults":{"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"blue","value":null}]},"unit":"short"},"overrides":[]},"gridPos":{"h":4,"w":3,"x":3,"y":1},"id":3,"options":{"colorMode":"value","graphMode":"none","justifyMode":"center","orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"title":"Total Users","type":"stat","targets":[{"expr":"immich_users_total{job=\"immich-metrics\"}","refId":"A"}]},{"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":5},"id":10,"panels":[],"title":"Database Operations","type":"row"},{"datasource":{"type":"prometheus","uid":"$${DS_PROMETHEUS}"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisCenteredZero":false,"axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","lineInterpolation":"smooth","lineWidth":2,"pointSize":5,"showPoints":"never","spanNulls":false,"stacking":{"group":"A","mode":"none"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"s"},"overrides":[]},"gridPos":{"h":8,"w":12,"x":0,"y":6},"id":11,"options":{"legend":{"calcs":["mean","max"],"displayMode":"table","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"desc"}},"title":"Database Avg Duration","type":"timeseries","targets":[{"expr":"rate(immich_database_repository_get_row_count_duration_sum{job=\"immich-metrics\"}[5m]) / rate(immich_database_repository_get_row_count_duration_count{job=\"immich-metrics\"}[5m])","legendFormat":"Get Row Count","refId":"A"},{"expr":"rate(immich_database_repository_acquire_lock_duration_sum{job=\"immich-metrics\"}[5m]) / rate(immich_database_repository_acquire_lock_duration_count{job=\"immich-metrics\"}[5m])","legendFormat":"Acquire Lock","refId":"B"}]},{"datasource":{"type":"prometheus","uid":"$${DS_PROMETHEUS}"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisCenteredZero":false,"axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","lineInterpolation":"smooth","lineWidth":2,"pointSize":5,"showPoints":"never","spanNulls":false,"stacking":{"group":"A","mode":"none"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"ops"},"overrides":[]},"gridPos":{"h":8,"w":12,"x":12,"y":6},"id":12,"options":{"legend":{"calcs":["mean","max"],"displayMode":"table","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"desc"}},"title":"Database Operations Rate","type":"timeseries","targets":[{"expr":"rate(immich_database_repository_get_row_count_duration_count{job=\"immich-metrics\"}[5m])","legendFormat":"Get Row Count","refId":"A"},{"expr":"rate(immich_database_repository_acquire_lock_duration_count{job=\"immich-metrics\"}[5m])","legendFormat":"Acquire Lock","refId":"B"},{"expr":"rate(immich_database_repository_release_lock_duration_count{job=\"immich-metrics\"}[5m])","legendFormat":"Release Lock","refId":"C"}]},{"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":14},"id":20,"panels":[],"title":"Machine Learning","type":"row"},{"datasource":{"type":"prometheus","uid":"$${DS_PROMETHEUS}"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisCenteredZero":false,"axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":20,"gradientMode":"none","lineInterpolation":"smooth","lineWidth":2,"pointSize":5,"showPoints":"never","spanNulls":false,"stacking":{"group":"A","mode":"none"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"ops"},"overrides":[]},"gridPos":{"h":8,"w":12,"x":0,"y":15},"id":21,"options":{"legend":{"calcs":["mean","max"],"displayMode":"table","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"desc"}},"title":"ML Operations Rate","type":"timeseries","targets":[{"expr":"rate(immich_machine_learning_repository_check_duration_count{job=\"immich-metrics\"}[5m])","legendFormat":"Check","refId":"A"},{"expr":"rate(immich_machine_learning_repository_tick_duration_count{job=\"immich-metrics\"}[5m])","legendFormat":"Tick","refId":"B"}]},{"datasource":{"type":"prometheus","uid":"$${DS_PROMETHEUS}"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisCenteredZero":false,"axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","lineInterpolation":"smooth","lineWidth":2,"pointSize":5,"showPoints":"never","spanNulls":false,"stacking":{"group":"A","mode":"none"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"s"},"overrides":[]},"gridPos":{"h":8,"w":12,"x":12,"y":15},"id":22,"options":{"legend":{"calcs":["mean","max"],"displayMode":"table","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"desc"}},"title":"ML Avg Duration","type":"timeseries","targets":[{"expr":"rate(immich_machine_learning_repository_check_duration_sum{job=\"immich-metrics\"}[5m]) / rate(immich_machine_learning_repository_check_duration_count{job=\"immich-metrics\"}[5m])","legendFormat":"Check","refId":"A"},{"expr":"rate(immich_machine_learning_repository_tick_duration_sum{job=\"immich-metrics\"}[5m]) / rate(immich_machine_learning_repository_tick_duration_count{job=\"immich-metrics\"}[5m])","legendFormat":"Tick","refId":"B"}]},{"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":23},"id":30,"panels":[],"title":"Storage Operations","type":"row"},{"datasource":{"type":"prometheus","uid":"$${DS_PROMETHEUS}"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisCenteredZero":false,"axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":20,"gradientMode":"none","lineInterpolation":"smooth","lineWidth":2,"pointSize":5,"showPoints":"never","spanNulls":false,"stacking":{"group":"A","mode":"none"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"ops"},"overrides":[]},"gridPos":{"h":8,"w":12,"x":0,"y":24},"id":31,"options":{"legend":{"calcs":["mean","max"],"displayMode":"table","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"desc"}},"title":"Storage Operations Rate","type":"timeseries","targets":[{"expr":"rate(immich_storage_repository_read_file_duration_count{job=\"immich-metrics\"}[5m])","legendFormat":"Read File","refId":"A"},{"expr":"rate(immich_storage_repository_overwrite_file_duration_count{job=\"immich-metrics\"}[5m])","legendFormat":"Overwrite File","refId":"B"},{"expr":"rate(immich_storage_repository_readdir_duration_count{job=\"immich-metrics\"}[5m])","legendFormat":"Read Dir","refId":"C"}]},{"datasource":{"type":"prometheus","uid":"$${DS_PROMETHEUS}"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisCenteredZero":false,"axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":20,"gradientMode":"none","lineInterpolation":"smooth","lineWidth":2,"pointSize":5,"showPoints":"never","spanNulls":false,"stacking":{"group":"A","mode":"none"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"ops"},"overrides":[]},"gridPos":{"h":8,"w":12,"x":12,"y":24},"id":32,"options":{"legend":{"calcs":["mean","max"],"displayMode":"table","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"desc"}},"title":"Events Rate","type":"timeseries","targets":[{"expr":"rate(immich_event_repository_emit_duration_count{job=\"immich-metrics\"}[5m])","legendFormat":"Emit","refId":"A"},{"expr":"rate(immich_event_repository_on_event_duration_count{job=\"immich-metrics\"}[5m])","legendFormat":"On Event","refId":"B"}]},{"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":32},"id":40,"panels":[],"title":"Asset & Album Operations","type":"row"},{"datasource":{"type":"prometheus","uid":"$${DS_PROMETHEUS}"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisCenteredZero":false,"axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":20,"gradientMode":"none","lineInterpolation":"smooth","lineWidth":2,"pointSize":5,"showPoints":"never","spanNulls":false,"stacking":{"group":"A","mode":"none"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"ops"},"overrides":[]},"gridPos":{"h":8,"w":12,"x":0,"y":33},"id":41,"options":{"legend":{"calcs":["mean","max"],"displayMode":"table","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"desc"}},"title":"Asset Operations Rate","type":"timeseries","targets":[{"expr":"rate(immich_asset_repository_get_file_samples_duration_count{job=\"immich-metrics\"}[5m])","legendFormat":"Get File Samples","refId":"A"}]},{"datasource":{"type":"prometheus","uid":"$${DS_PROMETHEUS}"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisCenteredZero":false,"axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":20,"gradientMode":"none","lineInterpolation":"smooth","lineWidth":2,"pointSize":5,"showPoints":"never","spanNulls":false,"stacking":{"group":"A","mode":"none"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"ops"},"overrides":[]},"gridPos":{"h":8,"w":12,"x":12,"y":33},"id":42,"options":{"legend":{"calcs":["mean","max"],"displayMode":"table","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"desc"}},"title":"User Operations Rate","type":"timeseries","targets":[{"expr":"rate(immich_user_repository_get_count_duration_count{job=\"immich-metrics\"}[5m])","legendFormat":"Get Count","refId":"A"}]},{"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":41},"id":50,"panels":[],"title":"Crypto & Background Jobs","type":"row"},{"datasource":{"type":"prometheus","uid":"$${DS_PROMETHEUS}"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisCenteredZero":false,"axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":20,"gradientMode":"none","lineInterpolation":"smooth","lineWidth":2,"pointSize":5,"showPoints":"never","spanNulls":false,"stacking":{"group":"A","mode":"none"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"ops"},"overrides":[]},"gridPos":{"h":8,"w":12,"x":0,"y":42},"id":51,"options":{"legend":{"calcs":["mean","max"],"displayMode":"table","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"desc"}},"title":"Crypto Operations Rate","type":"timeseries","targets":[{"expr":"rate(immich_crypto_repository_random_bytes_as_text_duration_count{job=\"immich-metrics\"}[5m])","legendFormat":"Random Bytes","refId":"A"}]},{"datasource":{"type":"prometheus","uid":"$${DS_PROMETHEUS}"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisCenteredZero":false,"axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":20,"gradientMode":"none","lineInterpolation":"smooth","lineWidth":2,"pointSize":5,"showPoints":"never","spanNulls":false,"stacking":{"group":"A","mode":"none"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"ops"},"overrides":[]},"gridPos":{"h":8,"w":12,"x":12,"y":42},"id":52,"options":{"legend":{"calcs":["mean","max"],"displayMode":"table","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"desc"}},"title":"Job & Cron Operations Rate","type":"timeseries","targets":[{"expr":"rate(immich_job_repository_setup_duration_count{job=\"immich-metrics\"}[5m])","legendFormat":"Job Setup","refId":"A"},{"expr":"rate(immich_cron_repository_create_duration_count{job=\"immich-metrics\"}[5m])","legendFormat":"Cron Create","refId":"B"}]},{"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":50},"id":60,"panels":[],"title":"Websocket & Telemetry","type":"row"},{"datasource":{"type":"prometheus","uid":"$${DS_PROMETHEUS}"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisCenteredZero":false,"axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":20,"gradientMode":"none","lineInterpolation":"smooth","lineWidth":2,"pointSize":5,"showPoints":"never","spanNulls":false,"stacking":{"group":"A","mode":"none"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"ops"},"overrides":[]},"gridPos":{"h":8,"w":12,"x":0,"y":51},"id":61,"options":{"legend":{"calcs":["mean","max"],"displayMode":"table","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"desc"}},"title":"Websocket Operations Rate","type":"timeseries","targets":[{"expr":"rate(immich_websocket_repository_set_auth_fn_duration_count{job=\"immich-metrics\"}[5m])","legendFormat":"Set Auth","refId":"A"}]},{"datasource":{"type":"prometheus","uid":"$${DS_PROMETHEUS}"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisCenteredZero":false,"axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":20,"gradientMode":"none","lineInterpolation":"smooth","lineWidth":2,"pointSize":5,"showPoints":"never","spanNulls":false,"stacking":{"group":"A","mode":"none"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"ops"},"overrides":[]},"gridPos":{"h":8,"w":12,"x":12,"y":51},"id":62,"options":{"legend":{"calcs":["mean","max"],"displayMode":"table","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"desc"}},"title":"Telemetry & Plugin Operations Rate","type":"timeseries","targets":[{"expr":"rate(immich_telemetry_repository_wrap_duration_count{job=\"immich-metrics\"}[5m])","legendFormat":"Telemetry Wrap","refId":"A"},{"expr":"rate(immich_plugin_repository_get_all_plugins_duration_count{job=\"immich-metrics\"}[5m])","legendFormat":"Get Plugins","refId":"B"}]}],"refresh":"30s","schemaVersion":39,"tags":["immich","photos"],"templating":{"list":[{"current":{"selected":true,"text":"VictoriaMetrics","value":"P4169E866C3094E38"},"hide":0,"includeAll":false,"label":"Datasource","multi":false,"name":"DS_PROMETHEUS","options":[],"query":"prometheus","refresh":1,"regex":"","skipUrlSync":false,"type":"datasource"}]},"time":{"from":"now-6h","to":"now"},"timepicker":{},"timezone":"browser","title":"Immich","uid":"immich","version":1}
EOH
}
